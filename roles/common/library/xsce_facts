#!/bin/bash

if [ -n "$wan_device_override" ]; then
    WAN=$wan_device_override
else
    WAN=`/sbin/ip route ls | awk '{if($1=="default")print $5}' | tr -d ' '`
fi

if [ -n "$lan_device_override" ]; then
    LAN=$lan_device_override
else
    LAN=`/sbin/ip link show  | grep -v -e DOWN -e lo -e $WAN | grep mtu | awk -F":" '{print \$2}' |  tr -d ' '  | head -n1` 
fi

WAN_MAC=`/sbin/ip addr show $WAN | awk '/link\/ether/ { print \$2}' | tr [:lower:] [:upper:]`
LAN_MAC=`/sbin/ip addr show $LAN | awk '/link\/ether/ { print \$2}' | tr [:lower:] [:upper:]`


if [ -f /proc/device-tree/mfg-data/MN ]
	then
	XO_VERSION=`cat /proc/device-tree/mfg-data/MN`
	else
	XO_VERSION="none"
fi

cat << EOF
{
    "changed": false,
    "ansible_facts": {
        "xsce_facts_gathered": true,
        "xsce_wan_iface": "$WAN",
        "xsce_wan_mac" : "$WAN_MAC",
        "xsce_lan_iface": "$LAN",
        "xsce_lan_mac": "$LAN_MAC",
        "xo_version" : "$XO_VERSION"
    }
}
EOF

