- name: Install avahi package
  package: name={{ item }}
           state=present
  with_items:
   - libnss-mdns
   - avahi-daemon
   - avahi-discover
  tags:
    - download

- name: Create a user vor avahi
  user: name=avahi
        createhome=no
        shell=/bin/false

- name: Install avahi announce config files
  template: src=avahi/schoolserver.service
            dest=/etc/avahi/services/schoolserver.service
            owner=avahi
            group=avahi
            mode=640
  when: 'gui_wan == True'
  
- name: Grab a clean copy of ssh.service
  copy: src='/usr/share/doc/avahi-daemon/examples/ssh.service'
        dest='/etc/avahi/services/'

- name: set ssh port for avahi
  lineinfile: dest=/etc/avahi/services/ssh.service
              regexp='</port>$'
              line='    <port>{{ssh_port}}</port>'
              state=present
              backrefs=yes

- name: Enable avahi service
  service: name=avahi-daemon
           enabled=yes
