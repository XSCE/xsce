- name: Install vnc packages
  yum: name={{ item }}
           state=present
  with_items:
        - tigervnc-server
  when: ansible_distribution == "Fedora" or ansible_distribution == "CentOS"
  tags: download

- name: Download the noVNC source from our copy
  get_url: url={{ xsce_download_url }}/{{ novnc_version }}.tar.gz
           dest={{ downloads_dir }}
  tags: download2

- name: Expand novnc to our root directory
  unarchive: src={{ downloads_dir }}/{{ novnc_version }}.tar.gz
           dest={{ xsce_base }}
           owner=xsce-admin

- name: Create a link pointing to the current version
  file: src={{ xsce_base }}/{{ novnc_version }}
        dest={{ xsce_base }}/novnc
        state=link  

- name: Install the mate desktop for use with VNC
  shell: 'yum -y groupinstall "MATE Desktop"'
  when: ansible_distribution == "Fedora" or ansible_distribution == "CentOS"
  tags: download

- name: make the vnc directory
  file: path=/home/xsce-admin/.vnc
        owner=xsce-admin
        state=directory

- name: make a bin directory for vnc
  file: path=/home/xsce-admin/bin
        owner=xsce-admin
        state=directory

- name: Put templated files in place
  template: src={{ item.src }}
            dest={{ item.dest }}
            owner=xsce-admin
            mode=0755
  with_items:
     - { src: 'xstartup', dest: '/home/xsce-admin/.vnc/' }
     - { src: 'display-desktop', dest: '/home/xsce-admin/bin/' }
     - { src: 'secure-desktop', dest: '/home/xsce-admin/bin/' }
     - { src: 'vnc', dest: '/etc/init.d/' }

- name: copy the password file -- binary confuses template module
  copy: src=passwd
        dest=/home/xsce-admin/.vnc
         
