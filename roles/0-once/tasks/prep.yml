- name: Install xsce-extra repos
  template: backup=yes
            dest=/etc/yum.repos.d/xsce-extra.repo
            src=xsce-extra.repo
            owner=root
            mode=0666

- name: Install xsce-testing repos
  template: backup=yes
            dest=/etc/yum.repos.d/xsce-testing.repo
            src=xsce-testing.repo
            owner=root
            mode=0666

- name: Install rpmfusion-free-updates repo -- for exfat
  template: dest=/etc/yum.repos.d/rpmfusion-free-updates.repo
            src=rpmfusion-free-updates.repo
            owner=root
            mode=0666
  when:     ansible_distribution == "Fedora"

- name: Install proper repo -- for exfat
  template: dest=/etc/yum.repos.d/li.nux.ro.repo
            src=li.nux.ro.repo
            owner=root
            mode=0666
  when:     ansible_distribution == "CentOS"

- name: Create /etc/xsce
  file: path=/etc/xsce
        owner=root
        group=root
        mode=0755
        state=directory

- name: See if default config_vars.yml exists
  stat: path=/etc/xsce/config_vars.yml
  register: config_vars

- name: Install default config_vars.yml
  template: src=config_vars.yml
            dest=/etc/xsce/config_vars.yml
            owner=root
            group=root
            mode=0644
  when: config_vars.stat.exists == false

# this script can be sourced to get xsce location
- name: Create xsce.env file
  template: src=xsce.env.j2
            dest=/etc/xsce/xsce.env
            owner=root
            group=root
            mode=0644

- name: create ansible.d facts directory
  file: path=/etc/ansible/facts.d
        owner=root
        group=root
        mode=0750
        state=directory

- name: local facts script
  template: src=local_facts.fact.j2
            dest=/etc/ansible/facts.d/local_facts.fact
            owner=root
            group=root
            mode=0700

- name: re-read facts
  setup: filter=ansible_local

- name: Set XO model and preload
  set_fact:
    xo_model: '{{ ansible_local["local_facts"]["xo_model"] }}'
    xsce_preload: '{{ ansible_local["local_facts"]["xsce_preload"] }}'
