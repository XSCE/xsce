- name: Install xsce-extra repos
  template: backup=yes
            dest=/etc/yum.repos.d/xsce-extra.repo
            src=xsce-extra.repo
            owner=root
            mode=0666

- name: Install xsce-testing repos
  template: backup=yes
            dest=/etc/yum.repos.d/xsce-testing.repo
            src=xsce-testing.repo
            owner=root
            mode=0666

- name: Create /etc/xsce
  file: path=/etc/xsce
        owner=root
        group=root
        mode=0755
        state=directory

# this script can be sourced to get xsce location
- name: Create xsce.env file
  template: src=xsce.env.j2
            dest=/etc/xsce/xsce.env
            owner=root
            group=root
            mode=0644

- name: create ansible.d facts directory
  file: path=/etc/ansible/facts.d
        owner=root
        group=root
        mode=0750
        state=directory

- name: local facts script
  template: src=local_facts.fact.j2
            dest=/etc/ansible/facts.d/local_facts.fact
            owner=root
            group=root
            mode=0700

- name: re-read facts
  setup: filter=ansible_local

- name: Set xsce_prepped to False on first run, set XO model
  set_fact:
    xsce_prepped: False
    xo_model: '{{ ansible_local["local_facts"]["xo_model"] }}'

# workaround for fact that auto create does not work on ini_file
- name: Create xsce config file
  file: dest='{{ xsce_config_file }}'
        state=touch

- name: Add location section to config file
  ini_file: dest='{{ xsce_config_file }}'
            section=location
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: 'xsce_base'
      value: '{{ xsce_base }}'
    - option: 'xsce_dir'
      value: '{{ xsce_dir }}'

- name: add version section
  ini_file: dest='{{ xsce_config_file }}'
            section=version
            option='{{ item.option }}'
            value='{{ item.value }}'
  with_items:
    - option: 'xsce_branch'
      value: '{{ ansible_local["local_facts"]["xsce_branch"] }}'
    - option: 'xsce_commit'
      value: '{{ ansible_local["local_facts"]["xsce_commit"] }}'
    - option: 'install_date'
      value: '{{ ansible_date_time["iso8601"] }}'
    - option: 'install_xo'
      value: '{{ xo_model }}'

- name: Create /library
  file: path=/library
        owner=root
        group=root
        mode=0755
        state=directory
